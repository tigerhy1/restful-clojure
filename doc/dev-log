2016-07-14

clojure已经能对couchbase正常读写了。

下面需要做的是设计数据结构.

第一步，四个表：

1. user:(先只有微信用户登录) 

key: user_{$userId}

userId, name, openId, unionId

2. share:

key: share_{$shareId}

shareId, userId, movieId, description, like_cnt

3. comment:

key: comment_{$commentId}

commentId, shareId, userId, toCommentId, comment

4. movie:

key: movie_{$movieId}

movieId, name.


接口:

get_add_user
add_share
delete_share
add_comment
delete_comment
get_shares
get_shares_by_movie
get_shares_by_user
get_comments

先想想怎么做登录

如果要测试号的话，还得另弄一个微信了。

2016-07-18

先暂时把微信登陆给放一放。先做其他逻辑

2016-07-19

今天考虑把从接到请求到写入数据库，这一整条链条打通。

想了下程序结构的问题，最开始还是准备把所有东西放到一起。这样好维护些.

但是写程序，可以先不考虑登陆认证的事情。

2016-07-20

链条倒是打通了，把get-add-user这个逻辑给打通.

先不要想微信登陆的事情。先手动能测就行。

2016-07-21

还是先不管微信登陆的事情，但是得开始考虑和前端怎么联合起来。

突然想到这不就是Test Driven Developement

下一个功能开发add_share

movie的存储方法和user保持了一致。

share的添加要从share的外部来进行，share保持不和movie耦合。

1234567890123

2016-07-22

今天看有没有办法把add_share功能给弄好。

跑通了，但是还有小问题需要改下.

发现一个小bug, jsonDoc里的content没有弄成map

2016-07-23

还是以乐趣为主

昨天那个小bug在movie里面已经改了，现在get-uid里改.

其实对于clojure的map,还有一个小小的疑问:什么时候可以(:key m) 什么时候可以 (get m key)

再实现一个get-share就有基本功能，可以和前端联调起来了。

还要考虑一下并行的问题,map coll fun，是并行的吗?怎么弄成并行的.



现在到了可以联调的状态了，想了下，有两个事情可以做:

1. map fun r， 这个怎么放到一个list里去(原来用那儿json库，还要加一个response才行呢)

2. add-user, get-user这个逻辑放到单独一个文件里去


2016-07-24

忙里偷闲，写个代码.

现在要做的是把前后端连起来了。

2016-07-25

为了用ring-cors,感觉需要把ring的中间件的原理搞清楚.

2016-07-26

今天不着急，慢慢把ring-cors搞清楚.

CORS算是搞清楚了，进了一大步。

现在的问题是怎么把结果加到response里面.

2016-07-27

跨域访问昨天已经搞定(但好像在生产环境中还是不要跨域，因为至少要多请求一次呀,OPTIONS请求)，

今天的任务是调整接口内容，实现对接。

还有add-share接口.

2016-08-01

compojure get 拿到params搞定了，原来是要用ring-defaults中间件.

check-echo的功能实现好了,现在要做的是部署在那个阿里云机器上.

部署到虚拟机上遇到两个打包的问题: 1. lein uberjar: 主class的namespace要有:gen-class
                             2. 要用带standalone的jar包.
                             
下一步要在上面装couchbase

couchbase已经装好，下次来可以直接开始测微信登陆了。

2016-08-02

微信测试号的服务器配置搞定了.

2016-08-03

前端连不过来，不知道为什么.

是因为elm里面请求地址写的是localhost请求到我自己这台mac上了。。改成远程地址就好了。

2016-08-04

直接接登陆需要的工作还是比较多的，想个办法，先验证clojure ring的session是ok的。

2016-08-05

session是Ok的。





